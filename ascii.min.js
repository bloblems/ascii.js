"use strict";window.requestAnimationFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame;const ascii_style=".ascii{font-family:Courier New,Courier,Lucida Sans Typewriter,Lucida Typewriter,monospace;display:inline-block;overflow-x:hidden;white-space:pre}.ascii_line{display:block}.ascii_links a{position:absolute}.ascii_links a:hover{cursor:pointer}",round=Math.round,floor=Math.floor,ceil=Math.ceil,rand=Math.random,abs=Math.abs,cos=Math.cos,sin=Math.sin,acos=Math.acos,asin=Math.asin,acosh=Math.acosh,asinh=Math.asinh,atan=Math.atan,atan2=Math.atan2,atanh=Math.atanh,cbrt=Math.cbrt,exp=Math.exp,log=Math.log,max=Math.max,min=Math.min,pow=Math.pow,sqrt=Math.sqrt,tan=Math.tan,tanh=Math.tanh,trunc=Math.trunc,is_int=Number.isInteger,is_array=Array.isArray,PI=Math.PI,TWO_PI=2*PI,HALF_PI=PI/2,QUARTER_PI=PI/4,E=Math.E,SQRT2=Math.SQRT2,SQRT1_2=Math.SQRT1_2,LN2=Math.LN2,LN10=Math.LN10,LOG2E=Math.LOG2E,LOG10E=Math.LOG10E,DOM_CLASS_ASCII="ascii",DOM_CLASS_ASCII_ARRAY="ascii_array",DOM_CLASS_ASCII_LINKS="ascii_links",DOM_CLASS_ASCII_LINE="ascii_line",MOUSE_LEFT=0,MOUSE_MIDDLE=1,MOUSE_RIGHT=2,KEY_BACKSPACE=8,KEY_DELETE=46,KEY_ENTER=13,KEY_RETURN=13,KEY_TAB=9,KEY_ESCAPE=27,KEY_SHIFT=16,KEY_CONTROL=17,KEY_OPTION=17,KEY_ALT=18,KEY_UP=38,KEY_DOWN=40,KEY_LEFT=37,KEY_RIGHT=39,CANVAS_FIT=0,CANVAS_COVER=1,CANVAS_DEFAULT_FIT=CANVAS_FIT,BOX_CORNER=0,BOX_CENTER=1,BOX_TRANSPARENT=0,BOX_COVER=1,BOX_HOVER=0,BOX_INTERSECTION=1,BOX_BORDERS=[" \u2500\u2502\u250C\u2510\u2514\u2518\u251C\u2524\u2534\u252C\u253C"," \u2550\u2551\u2554\u2557\u255A\u255D\u2560\u2563\u2569\u2566\u256C"," \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588"],BOX_DEFAULT_MODE=0,BOX_DEFAULT_BORDER_CHARS=BOX_BORDERS[0],BOX_DEFAULT_ALPHA=0,BOX_DEFAULT_INTERSECTION=0,BOX_BORDER_INTERSECTION_HORIZONTAL=[1,1,11,10,10,9,9,11,11,9,10,11],BOX_BORDER_INTERSECTION_VERTICAL=[2,11,2,7,8,7,8,7,8,11,11,11],BOX_BORDER_INTERSECTION_TOP_LEFT=[3,10,7,3,10,7,11,7,11,11,10,11],BOX_BORDER_INTERSECTION_TOP_RIGHT=[4,10,8,10,4,11,8,11,8,11,10,11],BOX_BORDER_INTERSECTION_BOTTOM_LEFT=[5,9,7,7,11,5,9,7,11,9,11,11],BOX_BORDER_INTERSECTION_BOTTOM_RIGHT=[6,9,8,11,8,11,6,11,8,9,11,11],LINE_DEFAULT_CHAR=".",TEXT_BLOCK=0,TEXT_WRAP=1,TEXT_WRAP_HARD=2,TEXT_LEFT=0,TEXT_CENTER=1,TEXT_RIGHT=2,TEXT_ALIGN_LEFT=0,TEXT_ALIGN_CENTER=1,TEXT_ALIGN_RIGHT=2,TEXT_DEFAULT_WRAP=TEXT_BLOCK,TEXT_DEFAULT_MODE=0,TEXT_DEFAULT_ALIGN=TEXT_ALIGN_LEFT,DRAW_TEXT=0,DRAW_HTML=1,DRAW_DEFAULT_MODE=DRAW_TEXT;function ease_linear(t,e,n,i){return n*t/i+e}function ease_quad_in(t,e,n,i){return n*(t/=i)*t+e}function ease_quad_out(t,e,n,i){return-n*(t/=i)*(t-2)+e}function ease_quad_in_out(t,e,n,i){return(t/=i/2)<1?n/2*t*t+e:-n/2*(--t*(t-2)-1)+e}function ease_cubic_in(t,e,n,i){return n*(t/=i)*t*t+e}function ease_cubic_out(t,e,n,i){return t/=i,n*(--t*t*t+1)+e}function ease_cubic_in_out(t,e,n,i){return(t/=i/2)<1?n/2*t*t*t+e:n/2*((t-=2)*t*t+2)+e}function ease_quartic_in(t,e,n,i){return n*(t/=i)*t*t*t+e}function ease_quartic_out(t,e,n,i){return t/=i,-n*(--t*t*t*t-1)+e}function ease_quartic_in_out(t,e,n,i){return(t/=i/2)<1?n/2*t*t*t*t+e:-n/2*((t-=2)*t*t*t-2)+e}function ease_quintic_in(t,e,n,i){return n*(t/=i)*t*t*t*t+e}function ease_quintic_out(t,e,n,i){return t/=i,n*(--t*t*t*t*t+1)+e}function ease_quintic_in_out(t,e,n,i){return(t/=i/2)<1?n/2*t*t*t*t*t+e:n/2*((t-=2)*t*t*t*t+2)+e}function ease_sin_in(t,e,n,i){return-n*Math.cos(t/i*(Math.PI/2))+n+e}function ease_sin_out(t,e,n,i){return n*Math.sin(t/i*(Math.PI/2))+e}function ease_sin_in_out(t,e,n,i){return-n/2*(Math.cos(Math.PI*t/i)-1)+e}function ease_exp_in(t,e,n,i){return n*Math.pow(2,10*(t/i-1))+e}function ease_exp_out(t,e,n,i){return n*(1-Math.pow(2,-10*t/i))+e}function ease_exp_in_out(t,e,n,i){return(t/=i/2)<1?n/2*Math.pow(2,10*(t-1))+e:(t--,n/2*(2-Math.pow(2,-10*t))+e)}function ease_circular_in(t,e,n,i){return t/=i,-n*(Math.sqrt(1-t*t)-1)+e}function ease_circular_out(t,e,n,i){return t/=i,t--,n*Math.sqrt(1-t*t)+e}function ease_circular_in_out(t,e,n,i){return(t/=i/2)<1?-n/2*(Math.sqrt(1-t*t)-1)+e:(t-=2,n/2*(Math.sqrt(1-t*t)+1)+e)}function random(t=null,e=null){return 1==is_array(t)?t[floor(rand()*t.length)]:null==t?rand():null==e?rand()*t:t<e?rand()*(e-t)+t:rand()*(t-e)+e}function shuffle(t,e=!1){let n,i,o;for(0==e&&(t=t.slice()),n=t.length-1;n>=1;--n)i=floor(random(n)),o=t[n],t[n]=t[i],t[i]=o;return t}function map(t,e,n,i,o,_=!1){return t=(t=(t-e)/(n-e))*(o-i)+i,1==_?min(o,max(i,t)):t}function constrain(t,e,n){return min(n,max(e,t))}function is_float(t){return"number"==typeof t&&t%1!=0}class FrameLoop{constructor(t,e=0,n=t,i=!1,o=ease_linear){this.max=t,this.from=e,this.to=n,this.frame=0,this.value=e,this.range=e<n?n-e:-(e-n),this.go_back=i,this.ease=o}update_value(){1==this.go_back?this.frame<this.max/2?this.value=this.ease(this.frame,this.from,this.range,this.max/2):this.value=this.ease(this.frame-this.max/2,this.to,-this.range,this.max/2):this.value=this.ease(this.frame,this.from,this.range,this.max)}inc(){this.frame+=1,this.frame>=this.max&&(this.frame=0),this.update_value()}set(t){this.frame=t,this.frame>=this.max&&(this.frame=0),this.update_value()}}function create_ascii(t=window){t.ascii=null,t.canvas_width=0,t.canvas_height=0,t.layer_width=0,t.layer_height=0,t.char_width=0,t.char_height=0,t.mouse_x=0,t.mouse_y=0,t.touches=null;let e=null,n=null,i=null,o=null,_=null,a=CANVAS_DEFAULT_FIT,r=BOX_DEFAULT_BORDER_CHARS,l=BOX_DEFAULT_MODE,s=BOX_DEFAULT_ALPHA,u=BOX_DEFAULT_INTERSECTION,h=LINE_DEFAULT_CHAR,c=TEXT_DEFAULT_MODE,f=TEXT_DEFAULT_WRAP,d=TEXT_DEFAULT_ALIGN,E=DRAW_DEFAULT_MODE,T=!0,O=[],m=[];function R(){"function"==typeof t.setup&&(t.setup(),"function"==typeof t.draw&&(document.addEventListener("keydown",p),document.addEventListener("keyup",A),document.addEventListener("mousedown",I),document.addEventListener("mouseup",L),document.addEventListener("mousemove",C),document.addEventListener("touchstart",g),document.addEventListener("touchmove",g),document.addEventListener("touchend",g),"function"==typeof t.mouse_clicked&&document.addEventListener("click",t.mouse_clicked),"function"==typeof t.mouse_double_clicked&&document.addEventListener("dblclick",t.mouse_double_clicked),"function"==typeof t.mouse_down&&document.addEventListener("mousedown",t.mouse_down),"function"==typeof t.mouse_up&&document.addEventListener("mouseup",t.mouse_up),"function"==typeof t.mouse_move&&document.addEventListener("mousemove",t.mouse_move),"function"==typeof t.key_down&&document.addEventListener("keydown",t.key_down),"function"==typeof t.key_up&&document.addEventListener("keyup",t.key_up),"function"==typeof t.touch_start&&document.addEventListener("touchstart",t.touch_start),"function"==typeof t.touch_end&&document.addEventListener("touchend",t.touch_end),"function"==typeof t.touch_move&&document.addEventListener("touchmove",t.touch_move),"function"==typeof t.window_resized&&window.addEventListener("resize",t.window_resized),window.requestAnimationFrame(y)))}function y(){let e,i;if(t.draw(),i=n.childNodes,E==DRAW_TEXT)if(null==_)for(e=0;e<t.canvas_height;++e)i[e].textContent=t.ascii[e].join("");else!function(e){let n,i,o,a,r,l,s,u,h;for(o=0;o<t.canvas_height;++o){for(a=_[o],r=t.ascii[o],u=null,h=null,n="",i=0;i<t.canvas_width;++i)s=a[i][0],(l=a[i][1])!=u||s!=h?(null==u&&null==h?(n+='<span style="',null!=l&&(n+="color:"+l+";"),null!=s&&(n+="background:"+s),n+='">'+r[i]):(n+="</span>",null==l&&null==s||(n+='<span style="',null!=l&&(n+="color:"+l+";"),null!=s&&(n+="background:"+s),n+='">'),n+=r[i]),h=s,u=l):n+=r[i];null==u&&null==h||(n+="</span>"),e[o].innerHTML=n}}(i);else for(e=0;e<t.canvas_height;++e)i[e].innerHTML=t.ascii[e].join("");1==T&&window.requestAnimationFrame(y)}function p(t){m[t.keyCode]=!0}function A(t){m[t.keyCode]=!1}function I(t){O[t.button]=!0}function L(t){O[t.button]=!1}function C(e){let i,o,_;i=n.getBoundingClientRect(),o=e.clientX-i.left,o=round(o/i.width*t.canvas_width),mouse_x=min(o,t.canvas_width-1),_=e.clientY-i.top,_=round(_/i.height*t.canvas_height),mouse_y=min(_,t.canvas_height-1)}function g(e){let i,o,_,a;if(t.touches=[],e.touches.length>0)for(o=n.getBoundingClientRect(),i=0;i<e.touches.length;++i)_=e.touches[i].clientX-o.left,_=floor(_/o.width*t.canvas_width),a=e.touches[i].clientY-o.top,a=floor(a/o.height*t.canvas_height),t.touches.push({x:_,y:a})}t.Link=class{constructor(e,n,o,_,a=1){let r,l,s;0==is_int(n)&&(n=floor(n)),0==is_int(o)&&(o=floor(o)),"string"==typeof _?(this.string=_,l=_.length,s=1):(l=floor(_),s=floor(a)),(r=document.createElement("a")).style.left=t.char_width*n+"px",r.style.top=t.char_height*o+"px",r.style.width=t.char_width*l+"px",r.style.height=t.char_height*s+"px",i.appendChild(r),"string"==typeof e?r.href=e:"function"==typeof e&&(r.onclick=e),this.dom=r,this.url=e,this.x=n,this.y=o,this.w=l,this.h=s}print(){let e,n;if(n=o,null!=this.string){if(this.y<0||this.y>=t.layer_height)return;for(e=0;e<this.string.length;++e)if(!(this.x+e<0)){if(this.x+e>=t.layer_width)return;n[this.y][this.x+e]=this.string[e]}}}move_to(e,n){0==is_int(e)&&(e=floor(e)),0==is_int(n)&&(n=floor(n)),this.x=e,this.dom.style.left=t.char_width*e+"px",this.y=n,this.dom.style.top=t.char_height*n+"px"}remove(){1==i.contains(this.dom)&&i.removeChild(this.dom)}activate(){0==i.contains(this.dom)&&i.appendChild(this.dom)}},t.create_canvas=function(_=null,r=null,l=null){let s,u,h,c,f,d,E,T;if(_&&_.appendChild?c=_:"string"==typeof _?c=document.getElementById(_):(f=_,d=r,c="string"==typeof l?document.getElementById(l):l),null==c&&(c=document.body),null==e&&((e=document.createElement("div")).className=DOM_CLASS_ASCII,(n=document.createElement("div")).className=DOM_CLASS_ASCII_ARRAY,e.appendChild(n),(i=document.createElement("div")).className=DOM_CLASS_ASCII_LINKS,e.appendChild(i)),0==c.contains(e)&&c.appendChild(e),E=c.offsetWidth||0,T=c.offsetHeight||0,u=document.createElement("span"),n.appendChild(u),0==f||null==f?(u.textContent+=" ".repeat(100),h=E/(n.offsetWidth/100),f=floor(h)-(a==CANVAS_FIT?1:0),f=max(1,f),u.textContent=" ".repeat(f)):(0==is_int(f)&&(f=floor(f)),u.textContent+=" ".repeat(f)),u.className=DOM_CLASS_ASCII_LINE,t.ascii=[u.textContent.split("")],0==d||null==d){for(;n.offsetHeight<=T;)n.appendChild(u.cloneNode(!0)),t.ascii.push(u.textContent.split(""));a==CANVAS_FIT&&n.offsetHeight>T&&n.childNodes.length>1&&(t.ascii.pop(),n.removeChild(n.firstChild)),d=n.childNodes.length}else for(0==is_int(d)&&(d=floor(d)),s=1;s<d;++s)n.appendChild(u.cloneNode(!0)),t.ascii.push(u.textContent.split(""));t.char_width=n.offsetWidth/f,t.char_height=n.offsetHeight/d,t.canvas_width=f,t.canvas_height=d,t.layer_width=f,t.layer_height=d,o=t.ascii},t.resize_canvas=function(t=null,i=null){for(0==is_int(t)&&(t=floor(t)),0==is_int(i)&&(i=floor(i));n.firstChild;)n.removeChild(n.lastChild);create_canvas(t,i,e.parentNode)},t.move_canvas=function(n=0,i=0,o=!1,_="absolute"){e.style.position=_,1==o?(e.style.top=floor(i*t.char_height)+"px",e.style.left=floor(n*t.char_width)+"px"):(e.style.top=i+"px",e.style.left=n+"px")},t.set_canvas_fit=function(t=CANVAS_DEFAULT_FIT){a=t},t.create_layer=function(e=t.canvas_width,n=t.canvas_height){let i,o;for(0==is_int(e)&&(e=floor(e)),0==is_int(n)&&(n=floor(n)),i=[],o=0;o<n;++o)i.push(" ".repeat(e).split(""));return i},t.set_layer=function(e=null){null==e?(o=t.ascii,t.layer_width=t.canvas_width,t.layer_height=t.canvas_height):(o=e,t.layer_width=e[0].length,t.layer_height=e.length)},t.draw_layer=function(e,n=0,i=0,_=0,a=0,r=null,l=null){let s,u,h,c,f,d,E,T,O,m;for(0==is_int(n)&&(n=floor(n)),0==is_int(i)&&(i=floor(i)),0==is_int(_)&&(_=floor(_)),0==is_int(a)&&(a=floor(a)),f=e[0].length,d=e.length,null==r?r=e[0].length-_:0==is_int(r)&&(r=floor(r)),null==l?l=e.length-a:0==is_int(l)&&(l=floor(l)),r=min(r,f-_),l=min(l,d-a),s=o,m=0;m<l;++m)if(!((T=i+m)<0)){if(T>=t.layer_height)return;for(u=s[T],h=e[m+a],O=0;O<r;++O)(E=n+O)<0||E>=t.layer_width||" "!=(c=h[O+_])&&(u[E]=c)}},t.create_mask=t.create_layer,t.put_mask=function(e,n=0,i=0,_=!1){let a,r,l,s,u,h,c,f,d,E,T,O;for("boolean"==typeof n&&(_=n,n=0),f=i,0==is_int(c=n)&&(c=floor(c)),0==is_int(f)&&(f=floor(f)),u=e[0].length,h=e.length,a=o,O=0;O<h;++O)if(!((E=f+O)<0)){if(E>=t.layer_height)return;for(r=a[E],l=e[O],T=0;T<u;++T)(d=c+T)<0||d>=t.layer_width||" "==(s=l[T])^1==_&&(r[d]=" ")}},t.create_color_layer=function(){let e,n,i,o;for(e=[],o=0;o<t.canvas_height;++o){for(n=[],i=0;i<t.canvas_width;++i)n.push([null,null]);e.push(n)}return e},t.set_color=function(t=null){_=t},t.clear_color_layer=function(e){let n,i;for(i=0;i<t.canvas_height;++i)for(n=0;n<t.canvas_width;++n)e[i][n][0]=null,e[i][n][1]=null},t.box=function(e,n,i,_=i,a=null){let h,c,f,d,E,T,O,m;if(0==is_int(e)&&(e=floor(e)),0==is_int(n)&&(n=floor(n)),0==is_int(i)&&(i=floor(i)),0==is_int(_)&&(_=floor(_)),l==BOX_CENTER&&(e-=round(i/2),n-=round(_/2)),!(e>=t.layer_width||e+i<0||n>=t.layer_height||n+_<0||0==i||0==_)){if(c=1==is_int(a)?BOX_BORDERS[a%BOX_BORDERS.length]:a||r,h=o,n>=0&&n<t.layer_height){if(e>=0&&e<t.layer_width&&(s==BOX_COVER||" "!=c[3])&&(u==BOX_INTERSECTION?(m=BOX_BORDER_INTERSECTION_TOP_LEFT,O=c.indexOf(h[n][e]),h[n][e]=O>=0?c[m[O]]:c[3]):h[n][e]=c[3]),s==BOX_COVER||" "!=c[1])for(m=BOX_BORDER_INTERSECTION_HORIZONTAL,f=1;f<i-1;++f)if(!((E=e+f)<0)){if(E>=t.layer_width)break;u==BOX_INTERSECTION?(O=c.indexOf(h[n][E]),h[n][E]=O>=0?c[m[O]]:c[1]):h[n][E]=c[1]}(E=e+i-1)>=0&&E<t.layer_width&&(s==BOX_COVER||" "!=c[4])&&(u==BOX_INTERSECTION?(m=BOX_BORDER_INTERSECTION_TOP_RIGHT,O=c.indexOf(h[n][E]),h[n][E]=O>=0?c[m[O]]:c[4]):h[n][E]=c[4])}for(m=BOX_BORDER_INTERSECTION_VERTICAL,d=1;d<_-1;++d)if(!((T=n+d)<0)){if(T>=t.layer_height)return;if(e>=0&&e<t.layer_width&&(s==BOX_COVER||" "!=c[2])&&(u==BOX_INTERSECTION?(O=c.indexOf(h[T][e]),h[T][e]=O>=0?c[m[O]]:c[2]):h[T][e]=c[2]),s==BOX_COVER||" "!=c[0])for(f=1;f<i-1;++f)if(!((E=e+f)<0)){if(E>=t.layer_width)break;h[T][E]=c[0]}(E=e+i-1)>=0&&E<t.layer_width&&(s==BOX_COVER||" "!=c[2])&&(u==BOX_INTERSECTION?(O=c.indexOf(h[T][E]),h[T][E]=O>=0?c[m[O]]:c[2]):h[T][E]=c[2])}if((T=n+_-1)>=0&&T<t.layer_height){if(e>=0&&e<t.layer_width&&(s==BOX_COVER||" "!=c[5])&&(u==BOX_INTERSECTION?(m=BOX_BORDER_INTERSECTION_BOTTOM_LEFT,O=c.indexOf(h[T][e]),h[T][e]=O>=0?c[m[O]]:c[5]):h[T][e]=c[5]),s==BOX_COVER||" "!=c[1])for(m=BOX_BORDER_INTERSECTION_HORIZONTAL,f=1;f<i-1;++f)if(!((E=e+f)<0)){if(E>=t.layer_width)break;u==BOX_INTERSECTION?(O=c.indexOf(h[T][E]),h[T][E]=O>=0?c[m[O]]:c[1]):h[T][E]=c[1]}(E=e+i-1)>=0&&E<t.layer_width&&(s==BOX_COVER||" "!=c[6])&&(u==BOX_INTERSECTION?(m=BOX_BORDER_INTERSECTION_BOTTOM_RIGHT,O=c.indexOf(h[T][E]),h[T][E]=O>=0?c[m[O]]:c[6]):h[T][E]=c[6])}}},t.set_box_border=function(t=null){r=1==is_int(t)?BOX_BORDERS[t%BOX_BORDERS.length]:t||BOX_DEFAULT_BORDER_CHARS},t.set_box_mode=function(t=BOX_DEFAULT_MODE){l=t},t.set_box_alpha=function(t=BOX_DEFAULT_ALPHA){s=t},t.set_box_intersection=function(t=BOX_DEFAULT_INTERSECTION){u=t},t.set_line_char=function(t=null){h=t||LINE_DEFAULT_CHAR},t.line=function(e,n,i,_,a=null){let r,l,s,u,c,f,d;for(0==is_int(e)&&(e=floor(e)),0==is_int(n)&&(n=floor(n)),0==is_int(i)&&(i=floor(i)),0==is_int(_)&&(_=floor(_)),r=o,a=a||h,u=e<i?1:-1,c=n<_?1:-1,f=(l=abs(i-e))+(s=-abs(_-n));e>=0&&e<t.layer_width&&n>=0&&n<t.layer_height&&(r[n][e]=a),e!=i||n!=_;)(d=2*f)>=s&&(f+=s,e+=u),d<=l&&(f+=l,n+=c)},t.line_func=function(e,n,i,_,a){let r,l,s,u,h,c,f,d;for(0==is_int(e)&&(e=floor(e)),0==is_int(n)&&(n=floor(n)),0==is_int(i)&&(i=floor(i)),0==is_int(_)&&(_=floor(_)),r=o,u=e<i?1:-1,h=n<_?1:-1,c=(l=abs(i-e))+(s=-abs(_-n));;){if(1==(d=a(e,n,e>=0&&e<t.layer_width&&n>=0&&n<t.layer_height)))return;if(e==i&&n==_)break;(f=2*c)>=s&&(c+=s,e+=u),f<=l&&(c+=l,n+=h)}},t.set_text_wrap=function(t=TEXT_DEFAULT_WRAP){f=t},t.set_text_mode=function(t=TEXT_DEFAULT_MODE){c=t},t.set_text_align=function(t=TEXT_DEFAULT_ALIGN){d=t},t.text=function(e,n,i,_=null){let a,r,l,s,u,h;if(0==is_int(n)&&(n=floor(n)),0==is_int(i)&&(i=floor(i)),null!=_&&0==is_int(_)&&(_=floor(_)),a=o,n>=t.layer_width||i>=t.layer_height)return null;if(f==TEXT_BLOCK)c==TEXT_CENTER?n-=floor(e.length/2):c==TEXT_RIGHT&&(n-=e.length);else{if(f==TEXT_WRAP){if(0==(r=_||t.layer_width-n))return null;if(null!=(l=e.match(RegExp("[\\s\n]*.{1,"+r+"}(\\s+|$\n?)|(.{1,"+r+"})","g")))&&null!=_&&d!=TEXT_ALIGN_LEFT)for(h=0;h<l.length;++h)s=l[h].trim(),l[h]=d==TEXT_ALIGN_RIGHT?" ".repeat(_-s.length)+s:" ".repeat(floor((_-s.length)/2))+s;e=null!=l?l.join("\n"):""}else if(f==TEXT_WRAP_HARD){if(0==(r=_||t.layer_width-n))return null;l=e.match(RegExp("[\\s\n]*.{1,"+r+"}","g")),e=null!=l?l.join("\n"):""}null!=_&&(c==TEXT_CENTER?n-=floor(_/2):c==TEXT_RIGHT&&(n-=_))}for(u=n,h=0;h<e.length;++h)if("\n"==e[h]){if(u=n,++i>=t.layer_height)break}else u<0||" "==e[h]?++u:u<t.layer_width&&(a[i][u]=e[h],++u);return[u,i]},t.polygon=function(t,e,n,i,_,a,r=null,l=0){let s,u,h,c,f,d,E,T,O;for(0==is_int(t)&&(t=floor(t)),0==is_int(e)&&(e=floor(e)),null!=r&&_>2?(u=o,s=create_layer(layer_width,layer_height),set_layer(s)):s=o,f=round(t+cos(h=(c=TWO_PI/_)*(_-1)+l*c)*n),d=round(e+sin(h)*i),O=0;O<TWO_PI;O+=c)E=round(t+cos(h=O+l*c)*n),T=round(e+sin(h)*i),line(E,T,f,d,a),f=E,d=T;null!=r&&_>2&&(fill(t,e,r),set_layer(u),draw_layer(s))},t.clear=function(t=null){let e,n,i,_,a,r;for(i=(e=t||o)[0].length,_=e.length,r=0;r<_;++r)for(n=e[r],a=0;a<i;++a)n[a]=" "},t.background=function(e){let n,i,_,a;for(n=o,a=0;a<t.layer_height;++a)for(i=n[a],_=0;_<t.layer_width;++_)i[_]=e},t.fill=function(e,n,i){let _,a;0==is_int(e)&&(e=floor(e)),0==is_int(n)&&(n=floor(n)),(a=(_=o)[n][e])!=i&&(_[n][e]=i,e>0&&_[n][e-1]==a&&fill(e-1,n,i),e<t.layer_width-1&&_[n][e+1]==a&&fill(e+1,n,i),n>0&&_[n-1][e]==a&&fill(e,n-1,i),n<t.layer_height-1&&_[n+1][e]==a&&fill(e,n+1,i))},t.iter_func=function(t,e=o){let n,i,_,a,r;for(a=e[0].length,r=e.length,_=0;_<r;++_)for(n=e[_],i=0;i<a;++i)t(n[i],i,_,e)},t.map_func=function(t,e=o){let n,i,_,a,r,l,s;for(l=e[0].length,s=e.length,n=create_layer(l,s),r=0;r<s;++r)for(i=e[r],_=n[r],a=0;a<l;++a)_[a]=t(i[a],a,r,e);for(r=0;r<s;++r)for(i=e[r],_=n[r],a=0;a<l;++a)i[a]=_[a]},t.is_on_canvas=function(t,e){return t>=0&&t<canvas_width&&e>=0&&e<canvas_height},t.is_on_layer=function(t,e){return t>=0&&t<layer_width&&e>=0&&e<layer_height},t.is_key_down=function(t){return m[t]||!1},t.is_mouse_down=function(t=null){return null==t?O[0]||O[1]||O[2]||!1:O[t]||!1},t.no_loop=function(){T=!1},t.loop=function(){(T=!1)&&(T=!0,"function"==typeof t.draw&&window.requestAnimationFrame(y))},t.set_draw_mode=function(t=DRAW_DEFAULT_MODE){E=t},"complete"==document.readyState?R():window.addEventListener("load",R)}window.addEventListener("load",function(){let t;(t=document.createElement("style")).type="text/css",t.innerText=ascii_style,document.head.appendChild(t)}),create_ascii();